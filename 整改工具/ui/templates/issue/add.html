<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>New Issue</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='iview/styles/iview.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='vue.js') }}"></script>
    <script src="{{ url_for('static', filename='axios.min.js') }}"></script>
    <script src="{{ url_for('static', filename='iview/iview.min.js') }}"></script>
    <script src="{{ url_for('static', filename='richeditor/wangEditor.min.js') }}"></script>
</head>
<body >
<div id="app" class="layout">
    <div class="header" >
        <i-Menu mode="horizontal" theme="dark" >
            <div class="layout-logo"></div>
            <div class='head-title'> </div>
            <div class="layout-nav">
                <Menu-Item name="1">
                    <Icon type="ios-navigate"></Icon>
                    <a href = 'add.html'> Add Issue </a>
                </Menu-Item>
            </div>
        </i-Menu>
    </div>
    
    <div id='main-right-div' style="overflow: hidden; padding: 0px 20px;">
        <div class=".issue-question">
            问题明细：<br>
            <i-input v-model="question" type="textarea" :rows="4" placeholder="" />
        </div>
        <br/>
        <div class=".issue-depts">
            责任部门：<br>
            <i-Select v-model="depts" multiple filterable  style="width:80%">
                <i-Option v-for="item in depts_bm" :value="item" :key="item">[[ item ]]</i-Option>
                <i-Option value="-" disabled><hr/></i-Option>
                <i-Option v-for="item in depts_xz" :value="item" :key="item">[[item ]]</i-Option>
            </i-Select>
            <i-button @click="selectDepts_0"> 全选 </i-button>
            <i-button @click="selectDepts_1"> 县直部门 </i-button>
            <i-button @click="selectDepts_2"> 乡镇 </i-button>
            <i-button @click="selectDepts_3"> 清除 </i-button>
        </div>
        <br/>
        <div class=".issue-tips">
            整改方案：<br>
            <div id='tips-editor'></div>
        </div>
        <br/>
        <hr/>
        <br/>
        <i-button type="primary" @click="save"> 保存 </i-button>
    </div>
    
</div>

<script>
    var vm = new Vue({
        el: '#app',
        data: {
            question: '',
            depts:[],

            depts_bm: {{g.depts_bm | tojson}},
            depts_xz: {{g.depts_xz | tojson}},
        },
        delimiters: ["[[","]]"],    //用于避免与flask冲突
        mounted: function() {
            // var cntHeight = window.innerHeight - 60 - 22;
            // document.getElementById('main-right-div').style.height = '' + cntHeight + 'px';
        },
        methods: {
            selectDepts_0: function() {
                this.depts.splice(0, this.depts.length);
                for (i in this.depts_bm) this.depts.push(this.depts_bm[i]);
                for (i in this.depts_xz) this.depts.push(this.depts_xz[i]);
            },
            selectDepts_1: function() {
                this.depts.splice(0, this.depts.length);
                for (i in this.depts_bm) this.depts.push(this.depts_bm[i]);
            },
            selectDepts_2: function() {
                this.depts.splice(0, this.depts.length);
                for (i in this.depts_xz) this.depts.push(this.depts_xz[i]);
            },
            selectDepts_3: function() {
                this.depts.splice(0, this.depts.length);
            },
            save: function() {
                var vm = this;
                r = {'question': this.question, 'depts': this.depts.join(','), 'tips': editorTips.txt.html()};
                var url = '/issue/';
                axios.post(url, r).then(function (res) {
                    var data = res.data;
                    console.log(data);
                    if (data && data.status == 'OK') {
                        vm.$Message.success({background: true, content: 'Update success'});
                    } else {
                        vm.$Message.error({background: true, duration:5, content: data.msg});
                    }
                });
            }
        },
    });

    const editorTips = new wangEditor("#tips-editor")
    editorTips.config.height = 350;  // 设置编辑区域高度为 500px  ，默认为 300px
    editorTips.config.pasteIgnoreImg = false; // 显示paste图片
    editorTips.config.uploadImgShowBase64 = true;
    editorTips.config.zIndex = 10;
    editorTips.create()
    // editor.txt.html('<p>用 JS 设置的内容</p>') // 重新设置编辑器内容
    // editor.txt.append('<p>追加的内容</p>') 继续追加内容
    // 使用 editor.txt.html() 获取 html 
    // editor.disable() 禁用编辑器  editor.enable()

</script>
</body>
</html>